# OpenCode 提示词设计规范

本规范用于统一 OpenCode 场景下的提示词写法，减少跑偏与返工。

---

## 0. 适用范围

- `/opsx-ff` 提案类提示词
- `/opsx-apply` 执行类提示词
- `/opsx-verify` 校验类提示词
- 失败排查与回归收敛提示词
- 多智能体交接提示词

---

## 1. 统一结构（推荐 5 段）

每条提示词尽量包含以下要素：

1. 目标：本次只做什么
2. 输入：`<CHANGE_ID>`、问题描述、环境约束
3. 约束：最小改动、禁止无关重构、范围边界
4. 输出：必须产物与路径
5. 验收：通过标准与风险说明

---

## 2. 占位符规范

- 统一使用全大写下划线：`<CHANGE_ID>`
- 一类语义只保留一个名称，避免同义混用
- 常用占位符：
  - `<CHANGE_ID>`
  - `<BUG_DESC>`
  - `<BACKEND_TEST_CMD>`
  - `<FRONTEND_TEST_CMD>`
  - `<E2E_TEST_CMD>`

---

## 3. 提案类模板（Sisyphus）

```text
/opsx-ff 为 <CHANGE_ID> 创建变更，目标：<SCOPE_DESC>。
请基于 <CHANGE_ID> 完善 specs/tasks：
1) 明确范围、边界与影响模块
2) 定义最小实现方案与回归范围
3) 更新 tasks.md（实现/修复、回归、验证、归档）
输出需包含验收标准与剩余风险。
```

---

## 4. 执行类模板（Atlas）

```text
/opsx-apply <CHANGE_ID>
```

执行约束补充模板：

```text
请按 <CHANGE_ID> 执行并持续收敛未完成项：
1) 仅做最小改动
2) 每轮后执行必要回归
3) 更新 verification-report.md
4) 输出是否可归档结论
```

---

## 5. 失败排查模板（Hephaestus）

```text
这是一次失败排查，请仅处理本次失败相关问题：
1) 先定位根因与影响范围
2) 给出最小修复点
3) 修复后只跑必要回归
4) 输出失败原因、修复点、回归结果、剩余风险
```

---

## 6. 反例与修正

反例（范围过大）：

```text
请把系统全部重构并顺便优化性能与测试。
```

修正（范围可控）：

```text
请仅修复 <CHANGE_ID> 的失败项，不做无关重构。
修复后执行必要回归并更新 verification-report.md。
```

---

## 7. 交接格式（多智能体）

交接时固定输出：

- 当前状态：已完成/未完成
- 证据路径：日志、截图、报告路径
- 风险清单：已知风险与影响
- 下一步动作：可直接执行的 1-3 条指令

---

## 8. 自检清单

- [ ] 目标是否单一且明确
- [ ] 是否包含输入、约束、输出、验收
- [ ] 是否限制“仅最小改动”
- [ ] 是否要求证据路径与风险说明
- [ ] 是否避免同义词导致歧义
